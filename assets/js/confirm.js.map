{"version":3,"sources":["confirm.js"],"names":["BASE_URL","USERS_URL","CARTS_URL","confirmContent","document","querySelector","getLoggedID","localStorage","getItem","getOrderData","addEventListener","e","btnSelected","target","nodeName","btnChange","id","inputNum","parentNode","childNodes","value","selectProductId","dataset","patchCartNum","targetId","num","AUTH","axios","defaults","headers","common","Authorization","url","data","quantity","Number","patch","then","res","console","log","renderCartState","renderConfirmStatus","err","JSON","stringify","error","btnSendOrder","buildOrderList","cartData","parse","orderItems","map","item","productId","product","title","price","orderTables","find","tableId","orderTablesId","sum","sumWithService","forEach","intQty","intPrice","total","totalWithServiceFee","Math","round","newOrder","createdAt","Date","now","products","payment","paymentTaxIncluded","hasAllDelivered","sendOrderData","userId","swalWithBootstrapButtons","Swal","mixin","customClass","confirmButton","cancelButton","buttonsStyling","fire","text","icon","showCancelButton","cancelButtonText","confirmButtonText","reverseButtons","preConfirm","post","status","localCarts","carts","arrayOfDelete","request","axiosDeleteCart","push","Promise","all","results","length","setTimeout","window","location","replace","result","isConfirmed","renderConfirmContent","content","str","template","toThousandsComma","table","chargeContent","innerHTML","getCartData","get","setItem","sumWithTax","init","toString"],"mappings":"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","sourcesContent":["// const BASE_URL = 'http://localhost:3000';  \r\nconst BASE_URL = 'https://sideproject-pnp-json-server-vercel.vercel.app';\r\n\r\nconst USERS_URL = `${BASE_URL}/660/users`;\r\nconst CARTS_URL = `${BASE_URL}/660/carts`;\r\n\r\nconst confirmContent = document.querySelector(\".confirm-content\")\r\n\r\nfunction getLoggedID() {\r\n    return localStorage.getItem('userId') || 0;\r\n  }\r\n\r\nfunction getOrderData() {\r\n    return localStorage.getItem('orders') || 0;\r\n  }\r\n\r\n//更改產品數量\r\nconfirmContent.addEventListener(\"click\",(e)=>{\r\n    // console.log(e.target)\r\n    let btnSelected = e.target.nodeName\r\n    if(btnSelected !==\"BUTTON\"){\r\n        return\r\n    }\r\n    let btnChange = e.target.id;\r\n    // console.log(btnChange);\r\n    const inputNum = e.target.parentNode.childNodes[3];//抓input\r\n    if(btnChange === \"plus\"){\r\n        inputNum.value++\r\n    }else if(btnChange === \"minus\"&&inputNum.value>1){\r\n        inputNum.value--\r\n    }\r\n    let selectProductId = inputNum.dataset.id;\r\n    patchCartNum(selectProductId,inputNum.value)\r\n})\r\n\r\n//patch 產品數量變動\r\nfunction patchCartNum(targetId,num){\r\n    const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n    axios.defaults.headers.common.Authorization = AUTH;\r\n    const url = `${CARTS_URL}/${targetId}`;\r\n    \r\n    const data = {\r\n        quantity: Number(num)\r\n    }\r\n\r\n    axios.patch(url,data)\r\n    .then(res=>{\r\n        console.log(\"餐點數量已更改~\")\r\n        renderCartState();\r\n        renderConfirmStatus();\r\n    })\r\n    .catch(err=>{\r\n        console.log('error:::', JSON.stringify(error, null, 2));\r\n    })       \r\n}\r\n\r\n//組order資料\r\nconst btnSendOrder = document.querySelector(\".js-sendOrder\")\r\n\r\nbtnSendOrder.addEventListener(\"click\",buildOrderList);\r\n\r\nfunction buildOrderList(){\r\n    const cartData = JSON.parse(getOrderData());\r\n\r\n    //訂單單一餐點整理\r\n    const orderItems = cartData.map(item=>{\r\n        return {\r\n            productId: item.product.id,\r\n            quantity: item.quantity,\r\n            title: item.product.title,\r\n            price: item.product.price\r\n        };\r\n    })\r\n\r\n    const orderTables = cartData.find(item=>{\r\n        return item.tableId\r\n    })\r\n    const orderTablesId = `${orderTables.tableId}`;\r\n    \r\n    let sum = 0;\r\n    let sumWithService = 0;\r\n    cartData.forEach((item) => {\r\n        const intQty = Number(item.quantity) || 0;\r\n        const intPrice = Number(item.product.price);\r\n        const total = intQty * intPrice;\r\n        const totalWithServiceFee = (intQty * intPrice)+Math.round(intQty * intPrice * 0.1);\r\n        sum += total;\r\n        sumWithService += totalWithServiceFee;\r\n    });\r\n\r\n    //建立訂單資料\r\n    const newOrder = {\r\n        createdAt: Date.now(),\r\n        tableId: orderTablesId,\r\n        products: orderItems,\r\n        payment: sum,\r\n        paymentTaxIncluded: sumWithService,\r\n        hasAllDelivered: false\r\n    }\r\n    // console.log(newOrder);\r\n    sendOrderData(newOrder);\r\n}\r\n\r\n//送出order function\r\nfunction sendOrderData(data){\r\n    const userId = getLoggedID();\r\n\r\n    const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n    axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n    const url = `${USERS_URL}/${userId}/orders`;\r\n\r\n    //sweetAlert 確認餐點送出\r\n    const swalWithBootstrapButtons = Swal.mixin({\r\n        customClass:{\r\n            confirmButton: 'btn btn-primary btn-text-white',\r\n            cancelButton: \"btn btn-outline-secondary\"\r\n        },\r\n        buttonsStyling: false\r\n    })\r\n    swalWithBootstrapButtons.fire({\r\n        title: '確定要送出嗎?',\r\n        text: \"訂單送出去就無法更改囉!\",\r\n        icon: 'warning',\r\n        showCancelButton: true,\r\n        cancelButtonText: '等等我有點後悔!',\r\n        confirmButtonText: '對!我要送出!',\r\n        reverseButtons: true,\r\n        preConfirm:()=>{\r\n            return axios.post(url, data)\r\n            .then(res=>{\r\n                console.log(res.data);\r\n\r\n                //清空購物車(function寫在renderUserLayout.js)\r\n                if (res.status === 201) {\r\n                    const localCarts = localStorage.getItem('carts');\r\n                    const carts = JSON.parse(localCarts);\r\n\r\n                    // const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n                    // axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n                    let arrayOfDelete = [];\r\n                    carts.forEach((item) => {\r\n                        const request = axiosDeleteCart(item.id);\r\n                        arrayOfDelete.push(request);\r\n                    });\r\n                    console.log('arrayOfDelete:::', arrayOfDelete);\r\n\r\n                    Promise.all(arrayOfDelete)\r\n                    .then((results)=> {\r\n                    console.log('results:::', results);\r\n\r\n                  // results checker\r\n                  if (results.length === arrayOfDelete.length) {\r\n                    console.log('已全部刪除！');\r\n                    setTimeout(() => {\r\n                      console.log('Redirect!');\r\n                      window.location.replace('https://jonathanhsu0817.github.io/pnp-sideproject/menu.html');\r\n                    //   window.location.replace('./menu.html');\r\n                    }, 1500);\r\n                    /* end of setTimeout */\r\n                  }\r\n                })\r\n                }\r\n            })\r\n            .catch(err=>{\r\n                console.log(err)\r\n            })\r\n        }\r\n    }).then((result) => {\r\n        if (result.isConfirmed) {\r\n            swalWithBootstrapButtons.fire(\r\n            '已送出不復返!ヽ(●´∀`●)ﾉ',\r\n            '稍後幫您製作餐點~',\r\n            'success'\r\n          )\r\n        }\r\n    })\r\n}\r\n\r\n\r\n//渲染確認畫面\r\nfunction renderConfirmContent(data,sum){\r\n    let content = \"\";\r\n    let str = \"\";\r\n    data.forEach(item =>{\r\n        let template = `\r\n        <tr class=\"fs-8 fs-md-6\">\r\n            <td class=\"py-md-4\">${item.product.title}</td>\r\n            <td class=\"py-md-4 text-center\">$${toThousandsComma(item.product.price)}</td>\r\n            <td class=\"py-md-4 text-center\">\r\n                <div class=\"d-flex col-md-6 col-12 ms-md-15\">\r\n                    <button type=\"button\" id=\"minus\" data-method=\"patch\" class='btn btn-link text-decoration-none px-2' value=\"-\">-</button>\r\n                    <input data-id='${item.id}' name='quantity' type='number' value='${item.quantity}' min='1' class='form-control form-control-sm text-center' disabled/>\r\n                    <button type=\"button\" id=\"plus\" data-method=\"patch\" class='btn btn-link text-decoration-none px-2' value=\"+\">+</button>\r\n                </div>\r\n            </td>\r\n            <td class=\"py-md-4 text-end \">$${toThousandsComma(item.product.price*item.quantity)}</td>\r\n        </tr>\r\n        `\r\n        str+=template;\r\n    })\r\n\r\n    let table = `\r\n    <table class=\"table table-hover align-middle \">\r\n        <thead>\r\n            <tr>\r\n                <th width=\"35%\">餐點資訊</th>\r\n                <th width=\"15%\" class=\"text-center\">價格</th>\r\n                <th width=\"35%\" class=\"text-center\">數量</th>\r\n                <th width=\"15%\" class=\"text-end text-md-center\">小計</th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            ${str}\r\n        </tbody>\r\n    </table>\r\n    `\r\n    content+=table;\r\n\r\n    let chargeContent =`\r\n    <div class=\"confirm-charge-content d-flex flex-column mb-16\">\r\n        <div class=\"d-flex align-items-center ms-auto mb-1\">\r\n            <h5 class=\"fs-7 fs-md-6 mb-0\">小計金額：</h5>\r\n            <span class=\"cart-charge-total text-primary fs-7 fs-md-6 ms-2\">NT $${toThousandsComma(sum)}</span>\r\n         </div>\r\n        <div class=\"d-flex align-items-center  ms-auto mb-3\">\r\n            <h5 class=\"fs-8 fs-md-7 mb-0\">服務費(10%)：</h5>\r\n            <span class=\"cart-charge-total text-primary fs-8 fs-md-7 ms-2\">NT $${toThousandsComma(Math.round(sum*0.1))}</span>\r\n        </div>\r\n        <div class=\"d-flex align-items-center ms-auto\">\r\n            <h5 class=\"fs-7 fs-md-6 mb-0\">總共：</h5>\r\n            <span class=\"cart-charge-total text-primary fs-7 fs-md-6\">NT $${toThousandsComma(Math.round(sum*0.1)+sum)}</span>\r\n        </div>\r\n    </div>\r\n    `\r\n    content+=chargeContent;\r\n    confirmContent.innerHTML = content;\r\n}\r\n\r\n//抓取購物車整理的資料\r\nfunction renderConfirmStatus(){\r\n    // const cartData = JSON.parse(getCartData())\r\n    const userId = getLoggedID();\r\n\r\n    const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n    axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n    const url = `${USERS_URL}/${userId}/carts?_expand=product&_expand=table`;\r\n\r\n    getCartData(url)\r\n  }\r\n//取購物車api\r\nfunction getCartData(url) {\r\n    axios.get(url)\r\n    .then(res=>{\r\n        if (res.status === 200){\r\n            const cartData = res.data;\r\n            localStorage.setItem('orders', JSON.stringify(cartData));\r\n            let sum = 0;\r\n            let sumWithTax = 0;\r\n            cartData.forEach((item) => {\r\n            const intQty = Number(item.quantity);\r\n            const intPrice = Number(item.product.price);\r\n            const total = intQty * intPrice;\r\n            sum += total;\r\n            sumWithTax += (total + Math.round(total*0.1));\r\n            })\r\n            // console.log(cartData)\r\n            renderConfirmContent(cartData,sum)\r\n            // buildOrderList(cartData,sum,sumWithTax)\r\n        }\r\n    })\r\n    .catch(err=>{\r\n        console.log(err);\r\n    })\r\n}  \r\n\r\nfunction init(){\r\n    renderConfirmStatus();\r\n  }\r\n\r\ninit()\r\n\r\n//utillities\r\nfunction　toThousandsComma(num){\r\n    return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n}\r\n"],"file":"confirm.js"}