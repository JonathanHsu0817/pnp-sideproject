{"version":3,"sources":["adminRevenue.js"],"names":["BASE_URL","ORDERS_URL","sortingDataNum","data","filterData","forEach","item","products","productItem","obj","product","title","quantity","push","total","goods","num","sortingDataPrice","price","Math","round","renderC3Num","totalItemC3","Object","entries","sort","a","b","console","log","otherItem","filter","index","otherItemTotal","reduce","prev","curr","splice","length","newOtherTotalC3","chart","c3","generate","bindto","size","width","type","columns","color","pattern","renderC3Price","chart1","getOrderData","AUTH","localStorage","getItem","axios","defaults","headers","common","Authorization","url","get","then","res","orderData","err","init"],"mappings":"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","sourcesContent":["const BASE_URL = 'http://localhost:3000';\r\n// const BASE_URL = 'https://sideproject-pnp-json-server-vercel.vercel.app';\r\n\r\nconst ORDERS_URL = `${BASE_URL}/660/orders?_expand=table`;\r\n\r\nfunction sortingDataNum(data){\r\n    let filterData = []\r\n    data.forEach(item=>{\r\n      const {products} = item;\r\n      products.forEach(productItem=>{\r\n        let obj = {\r\n          product: productItem.title,\r\n          quantity: productItem.quantity\r\n        }\r\n        filterData.push(obj)\r\n      })\r\n    })\r\n    let total = {};\r\n    filterData.forEach(goods=>{\r\n      let num = 0\r\n      if(!total[goods.product]){\r\n        num = goods.quantity*1\r\n        return total[goods.product] = num\r\n      }else{\r\n        num = total[goods.product]+goods.quantity*1\r\n        return total[goods.product] = num\r\n      }\r\n    })\r\n    return total\r\n  }\r\n\r\n  function sortingDataPrice(data){\r\n    let filterData = []\r\n    data.forEach(item=>{\r\n      const {products} = item;\r\n      products.forEach(productItem=>{\r\n        let obj = {\r\n          product: productItem.title,\r\n          quantity: productItem.quantity,\r\n          price: productItem.price\r\n        }\r\n        filterData.push(obj)\r\n      })\r\n    })\r\n    let total = {};\r\n    filterData.forEach(goods=>{\r\n      let price = 0\r\n      if(!total[goods.product]){\r\n        price = goods.quantity*goods.price*1.1\r\n        return total[goods.product] = Math.round(price)\r\n      }else{\r\n        price = total[goods.product]+goods.quantity*goods.price*1.1\r\n        return total[goods.product] = Math.round(price)\r\n      }\r\n    })\r\n    return total\r\n  }\r\n\r\nfunction renderC3Num(data){\r\n    //改成C3格式\r\n    let totalItemC3 = Object.entries(data)\r\n    totalItemC3.sort((a,b)=>{\r\n        return b[1]-a[1]\r\n    })\r\n    console.log(totalItemC3)\r\n    \r\n\r\n    let otherItem = totalItemC3.filter((item,index)=>{\r\n        return index>2\r\n    })\r\n    // console.log(otherItem);\r\n    let otherItemTotal = otherItem.reduce((prev,curr)=>{\r\n        // console.log(prev[0]+curr[0]);\r\n        return [`其他`,prev[1]+curr[1]]\r\n    })\r\n    totalItemC3.splice(3,totalItemC3.length-1)\r\n    let newOtherTotalC3 = [...totalItemC3,...[otherItemTotal]];\r\n    \r\n    let chart = c3.generate({\r\n        bindto: '.chartNum', // HTML 元素綁定\r\n        size:{\r\n            width:480\r\n        },\r\n        data: {\r\n            type: \"pie\",\r\n            columns: newOtherTotalC3,\r\n        },\r\n        color:{ \r\n            pattern: [\"#EC6D4E\",\"#FCE9E4\",\"#7889A3\",\"#c2c2c2\"]\r\n        }\r\n    });\r\n    return chart;\r\n}\r\n\r\nfunction renderC3Price(data){\r\n    //改成C3格式\r\n    let totalItemC3 = Object.entries(data)\r\n    totalItemC3.sort((a,b)=>{\r\n        return b[1]-a[1]\r\n    })\r\n    let otherItem = totalItemC3.filter((item,index)=>{\r\n        return index>2\r\n    })\r\n    let otherItemTotal = otherItem.reduce((prev,curr)=>{\r\n        return [`其他`,prev[1]+curr[1]]\r\n    })\r\n\r\n    totalItemC3.splice(3,totalItemC3.length-1)\r\n\r\n    let newOtherTotalC3 = [...totalItemC3,...[otherItemTotal]];\r\n    \r\n    let chart1 = c3.generate({\r\n        bindto: '.chartPrice', // HTML 元素綁定\r\n        size:{\r\n            width:480\r\n        },\r\n        data: {\r\n            type: \"pie\",\r\n            columns: newOtherTotalC3,\r\n        },\r\n        color:{ \r\n            pattern: [\"#EC6D4E\",\"#FCE9E4\",\"#7889A3\",\"#c2c2c2\"]\r\n        }\r\n    });\r\n    return chart1;\r\n}\r\n\r\nfunction getOrderData(){\r\n    const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n    axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n    const url = `${ORDERS_URL}`;\r\n\r\n    axios.get(url)\r\n    .then(res=>{\r\n        const orderData = res.data\r\n        // console.log(sortingDataNum(orderData));\r\n        renderC3Num(sortingDataNum(orderData))\r\n        // console.log(sortingDataPrice(orderData));\r\n        renderC3Price(sortingDataPrice(orderData))\r\n    })\r\n    .catch(err=>{\r\n        console.log(err);\r\n    })\r\n}\r\n\r\nfunction init(){\r\n    getOrderData()\r\n}\r\n\r\ninit();"],"file":"adminRevenue.js"}