{"version":3,"sources":["renderAdminLayout.js"],"names":["BASE_URL","LOGIN_URL","USERS_URL","ORDERS_URL","formLogin","document","querySelector","btnLogin","btnUserMenu","saveUserToLocal","accessToken","user","localStorage","setItem","id","nickname","login","console","log","url","data","email","value","trim","password","hasInput","axios","post","then","response","status","sweetSuccess","redirectPath","isAdmin","role","setTimeout","window","location","replace","error","sweetError","addEventListener","getLoggedID","getItem","templateOfAdminMenu","template","renderAdminMenu","userId","get","innerHTML","clear","logout","e","target","targetBtn","closest","totalList","renderTotalState","AUTH","defaults","headers","common","Authorization","res","cartData","cartDataFiltered","filter","item","hasAllDelivered","renderTotalList","sortingData","filterData","forEach","products","productItem","obj","product","title","quantity","push","total","goods","num","arr","Object","entries","list","sort","init","localToken","event"],"mappings":"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","sourcesContent":["// const BASE_URL = 'http://localhost:3000';\r\nconst BASE_URL = 'https://sideproject-pnp-json-server-vercel.vercel.app';\r\nconst LOGIN_URL = `${BASE_URL}/login`;\r\nconst USERS_URL = `${BASE_URL}/600/users`;\r\nconst ORDERS_URL = `${BASE_URL}/660/orders?_expand=table`;\r\n\r\nconst formLogin = document.querySelector(\".js-form-login\");\r\nconst btnLogin = document.querySelector(\".js-btn-login\");\r\nconst btnUserMenu = document.querySelector('.js-user-selection');\r\n\r\n\r\n\r\nfunction saveUserToLocal({ accessToken, user }) {\r\n  localStorage.setItem('token', accessToken);\r\n  localStorage.setItem('userId', user.id);\r\n  localStorage.setItem('nickname', user.nickname);\r\n}\r\n//登入\r\nfunction login() {\r\n    console.log('Login!');\r\n  \r\n    const url = `${LOGIN_URL}`;\r\n  \r\n    const data = {\r\n      email: formLogin.email.value.trim(),\r\n      password: formLogin.password.value.trim(),\r\n    };\r\n  \r\n    const hasInput = data.email && data.password;\r\n    if (hasInput) {\r\n      return axios\r\n        .post(url, data)\r\n        .then(function (response) {\r\n          // console.log('login:::', JSON.stringify(response, null, 2));\r\n          if (response.status === 200) {\r\n            sweetSuccess(\"登入成功!\", \"歡迎光臨~\")\r\n            saveUserToLocal(response.data);\r\n  \r\n            let redirectPath = '/';\r\n            // const isAdmin = response.data?.user?.role?.includes('admin');\r\n            const isAdmin = response.data?.user?.role === 'admin';\r\n            if (isAdmin) {\r\n              redirectPath = 'admin.html';\r\n            }\r\n  \r\n            setTimeout(() => {\r\n              console.log('Redirect!');\r\n              window.location.replace(redirectPath);\r\n            }, 150);\r\n            /* end of setTimeout */\r\n          }\r\n          /* end of response.OK */\r\n        })\r\n        .catch(function (error) {\r\n          sweetError(\"登入失敗\", \"再重新試一試喔~\")\r\n          // console.log('error:::', JSON.stringify(error, null, 2));\r\n        });\r\n      /*  end of axios */\r\n    }\r\n    /* end of IF-hasInput */\r\n}\r\n  btnLogin.addEventListener('click', () => login());\r\n\r\nfunction getLoggedID() {\r\n    return localStorage.getItem('userId') || 0;\r\n}\r\n\r\nfunction templateOfAdminMenu(user, template = '') {\r\n    // console.log('me:::', JSON.stringify(user, null, 2));\r\n    const isAdmin = user?.role === 'admin';\r\n    if (isAdmin) {\r\n      template = `\r\n        <li class=\"nav-item\">\r\n            <div class=\"d-flex\">\r\n                <a href=\"./index.html\" class=\"d-block btn btn-outline-primary btn-bg-white me-2\">\r\n                前往前台\r\n                </a>\r\n            </div>\r\n        </li>\r\n      `;\r\n    }\r\n    /* end of (isAdmin) */\r\n    template += `\r\n          <li class=\"nav-item\">\r\n            <div class=\"d-flex\">\r\n                <a href=\"#\" class=\"js-logout d-block btn btn-outline-primary btn-bg-white\">\r\n                登出\r\n                </a>\r\n            </div>\r\n        </li>\r\n    `;\r\n    return template;\r\n}\r\n\r\nfunction renderAdminMenu() {\r\n    const userId = getLoggedID();\r\n    const url = `${BASE_URL}/600/users/${userId}`;\r\n\r\n    axios.get(url)\r\n    .then(function (response) {\r\n        // console.log('GET-Me:::', JSON.stringify(response, null, 2));\r\n        if (response.status === 200) {\r\n          // console.log('OK!');\r\n          document.querySelector('.js-user-selection').innerHTML = '';\r\n          btnUserMenu.innerHTML = templateOfAdminMenu(response.data);\r\n        }\r\n        /* end of res-OK */\r\n    })\r\n    .catch(function (error) {\r\n        // console.log('error:::', JSON.stringify(error, null, 2));\r\n        if (error?.response?.status === 401) {\r\n            console.log('401');\r\n            // localStorage.removeItem('myCat');\r\n            localStorage.clear();\r\n        }\r\n    });\r\n}\r\n\r\nfunction logout(e) {\r\n    const target = e.target;\r\n    // console.log('target:::', target);\r\n    const targetBtn = e.target.closest('.js-logout');\r\n    // console.log('targetBtn:::', targetBtn);\r\n    if (!targetBtn) {\r\n      return;\r\n    }\r\n  \r\n    localStorage.clear();\r\n  \r\n    setTimeout(() => {\r\n      window.location.replace('/');\r\n    }, 300);\r\n    /* end of setTimeout */\r\n}\r\n//總計未出餐\r\nconst totalList = document.querySelector(\".total-content\")\r\n\r\nfunction renderTotalState(){\r\n  const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n  axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n  // #Step-2.4\r\n  const url = `${ORDERS_URL}`;\r\n\r\n  axios.get(url)\r\n  .then(res=>{\r\n    if (res.status === 200) {\r\n      const cartData = res.data;\r\n      // console.log(cartData);\r\n      const cartDataFiltered = cartData.filter(item=>{\r\n        return item.hasAllDelivered == false;\r\n      })\r\n      //整理數值\r\n      \r\n      renderTotalList(sortingData(cartDataFiltered))\r\n      // renderTotalList(cartData,sum)\r\n    }\r\n  })\r\n  //加入購物車按扭寫在menu-hot.js & 各別product.js上(不同邏輯)\r\n}\r\n\r\nfunction sortingData(data){\r\n  let filterData = []\r\n  data.forEach(item=>{\r\n    const {products} = item;\r\n    products.forEach(productItem=>{\r\n      let obj = {\r\n        product: productItem.title,\r\n        quantity: productItem.quantity\r\n      }\r\n      filterData.push(obj)\r\n    })\r\n  })\r\n  let total = {};\r\n  filterData.forEach(goods=>{\r\n    let num = 0\r\n    if(!total[goods.product]){\r\n      num = goods.quantity*1\r\n      return total[goods.product] = num\r\n    }else{\r\n      num = total[goods.product]+goods.quantity*1\r\n      return total[goods.product] = num\r\n    }\r\n  })\r\n  return total\r\n}\r\n\r\nfunction renderTotalList(data){\r\n  const arr = Object.entries(data)\r\n  let list= \"\";\r\n  arr.sort().forEach(item=>{\r\n    list +=`<tr>\r\n      <td width=\"55\">${item[0]}</td>\r\n      <td class=\"text-center\">${item[1]}</td>\r\n    </tr>`\r\n  })\r\n  let template =`<table class=\"table\" cellpadding=\"8\">\r\n    <thead>\r\n      <tr>\r\n        <th width=\"85%\">餐點</th>\r\n        <th width=\"15%\">數量</th>\r\n      </tr>\r\n    <thead>\r\n    <tbody>\r\n      ${list}\r\n    </tbody>    \r\n  </table>`\r\n  // console.log(template)\r\n  totalList.innerHTML = template;\r\n}\r\n\r\nfunction init() {\r\n    // console.log('getLoggedID():::', getLoggedID());\r\n    if (getLoggedID()) {\r\n      const localToken = localStorage.getItem('token');\r\n      const AUTH = `Bearer ${localToken}`;\r\n  \r\n      axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n      renderAdminMenu();\r\n      renderTotalState();\r\n\r\n      //購物車\r\n    }\r\n    /* end of if-getLoggedID */\r\n    btnUserMenu.addEventListener('click', (event) => logout(event));\r\n}\r\n  \r\n  // MAIN\r\n  init();"],"file":"renderAdminLayout.js"}