{"version":3,"sources":["renderUserLayout.js"],"names":["BASE_URL","LOGIN_URL","USERS_URL","PRODUCTS_URL","TABLES_URL","CARTS_URL","formLogin","document","querySelector","btnLogin","btnUserMenu","menuList","cartData","saveUserToLocal","accessToken","user","localStorage","setItem","id","nickname","login","console","log","url","data","email","value","trim","password","hasInput","axios","post","then","response","status","sweetSuccess","redirectPath","isAdmin","role","setTimeout","window","location","replace","error","sweetError","addEventListener","getLoggedID","getItem","templateOfUserMenu","template","renderUserMenu","userId","get","innerHTML","clear","logout","e","target","targetBtn","closest","targetMenuSelection","dataset","category","renderResturantMenu","content","tableSelection","nodeName","tableId","cartList","targetA","childNodes","targetId","AUTH","defaults","headers","common","Authorization","res","renderCartState","JSON","stringify","btnConfirm","innerText","length","deleteAllCart","carts","parse","arrayOfDelete","forEach","item","request","axiosDeleteCart","push","Promise","all","results","cartId","renderNoCartData","sum","sumWithTax","intQty","Number","quantity","intPrice","product","price","total","renderCartList","str","list","img","title","toThousandsComma","cartTotal","init","localToken","event","num","toString"],"mappings":"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","sourcesContent":["// const BASE_URL = 'http://localhost:3000';\r\nconst BASE_URL = 'https://sideproject-pnp-json-server-vercel.vercel.app';\r\n\r\nconst LOGIN_URL = `${BASE_URL}/login`;\r\nconst USERS_URL = `${BASE_URL}/660/users`;\r\nconst PRODUCTS_URL = `${BASE_URL}/664/products`;\r\nconst TABLES_URL = `${BASE_URL}/644/tables`;\r\nconst CARTS_URL = `${BASE_URL}/660/carts`;\r\n\r\nconst formLogin = document.querySelector(\".js-form-login\");\r\nconst btnLogin = document.querySelector(\".js-btn-login\");\r\nconst btnUserMenu = document.querySelector('.js-user-selection');\r\nconst menuList = document.querySelector(\".menu-list\");\r\n// console.log(menuList);\r\n\r\nlet cartData = [];\r\n\r\n////登入頁面\r\n\r\n//存至localStorage\r\nfunction saveUserToLocal({ accessToken, user }) {\r\n  localStorage.setItem('token', accessToken);\r\n  localStorage.setItem('userId', user.id);\r\n  localStorage.setItem('nickname', user.nickname);\r\n}\r\n\r\n\r\nfunction login() {\r\n  console.log('Login!');\r\n\r\n  const url = `${LOGIN_URL}`;\r\n\r\n  const data = {\r\n    email: formLogin.email.value.trim(),\r\n    password: formLogin.password.value.trim(),\r\n  };\r\n\r\n  const hasInput = data.email && data.password;\r\n  if (hasInput) {\r\n    return axios\r\n      .post(url, data)\r\n      .then(function (response) {\r\n        // console.log('login:::', JSON.stringify(response, null, 2));\r\n        if (response.status === 200) {\r\n          sweetSuccess(\"登入成功!\", \"歡迎光臨~\")\r\n          saveUserToLocal(response.data);\r\n\r\n          let redirectPath = 'https://jonathanhsu0817.github.io/pnp-sideproject/index.html';\r\n          // let redirectPath = '/';\r\n\r\n          const isAdmin = response.data?.user?.role === 'admin';\r\n          if (isAdmin) {\r\n            let redirectPath = 'https://jonathanhsu0817.github.io/pnp-sideproject/admin.html';\r\n            // redirectPath = './admin.html';\r\n          }\r\n\r\n          setTimeout(() => {\r\n            console.log('Redirect!');\r\n            window.location.replace(redirectPath);\r\n          }, 150);\r\n          /* end of setTimeout */\r\n        }\r\n        /* end of response.OK */\r\n      })\r\n      .catch(function (error) {\r\n        sweetError(\"登入失敗\", \"再重新試一試喔~\")\r\n        // console.log('error:::', JSON.stringify(error, null, 2));\r\n      });\r\n    /*  end of axios */\r\n  }\r\n  /* end of IF-hasInput */\r\n}\r\nbtnLogin.addEventListener('click', () => login());\r\n\r\n//判斷登入後渲染登入畫面\r\nfunction getLoggedID() {\r\n    return localStorage.getItem('userId') || 0;\r\n}\r\n  /* end of hasLogged() */\r\n\r\nfunction templateOfUserMenu(user, template = '') {\r\n    // console.log('me:::', JSON.stringify(user, null, 2));\r\n    const isAdmin = user?.role === 'admin';\r\n    if (isAdmin) {\r\n      template = `\r\n        <li class=\"nav-item\">\r\n            <div class=\"d-flex\">\r\n                <a href=\"./admin.html\" class=\"d-block btn btn-outline-primary btn-bg-white me-2\">\r\n                前往後台\r\n                </a>\r\n            </div>\r\n        </li>\r\n      `;\r\n    }\r\n    /* end of (isAdmin) */\r\n\r\n    template += `\r\n      <li class=\"nav-item\">\r\n        <div class=\"d-flex\">\r\n          <select name=\"table-selection\" id=\"table-selection\" class=\"border-primary bg-backStage text-primary me-2\">\r\n            <option value=\"請選擇桌號\">請選擇桌號</option>\r\n            <option value=\"1\">B1</option>\r\n            <option value=\"2\">B2</option>\r\n            <option value=\"3\">B3</option>\r\n            <option value=\"4\">B4</option>\r\n            <option value=\"5\">B5</option>\r\n            <option value=\"6\">B6</option>\r\n            <option value=\"7\">B7</option>\r\n            <option value=\"8\">B8</option>\r\n            <option value=\"9\">B9</option>\r\n          </select>\r\n          <a href=\"#\" class=\"js-logout d-block btn btn-outline-primary btn-bg-white\">\r\n            登出\r\n          </a>\r\n        </div>\r\n      </li>`;\r\n    return template;\r\n}\r\n  /* end of templateOfUserMenu() */ \r\n\r\n  function renderUserMenu() {\r\n    const userId = getLoggedID();\r\n    const url = `${BASE_URL}/600/users/${userId}`;\r\n  \r\n    axios.get(url)\r\n    .then(function (response) {\r\n        // console.log('GET-Me:::', JSON.stringify(response, null, 2));\r\n        if (response.status === 200) {\r\n          // console.log('OK!');\r\n          document.querySelector('.js-user-selection').innerHTML = '';\r\n          btnUserMenu.innerHTML = templateOfUserMenu(response.data);\r\n        }\r\n        /* end of res-OK */\r\n    })\r\n    .catch(function (error) {\r\n        // console.log('error:::', JSON.stringify(error, null, 2));\r\n        if (error?.response?.status === 401) {\r\n            console.log('401');\r\n            \r\n            localStorage.clear();\r\n        }\r\n    });\r\n  }\r\n  /* end of renderUserMenu() */  \r\n  function logout(e) {\r\n    const target = e.target;\r\n    \r\n    const targetBtn = e.target.closest('.js-logout');\r\n    \r\n    if (!targetBtn) {\r\n      return;\r\n    }\r\n  \r\n    localStorage.clear();\r\n  \r\n    setTimeout(() => {\r\n      window.location.replace('https://jonathanhsu0817.github.io/pnp-sideproject/index.html');\r\n      // window.location.replace('./index.html');\r\n    }, 300);\r\n    /* end of setTimeout */\r\n  }\r\n  /* end of logout(event) */  \r\n\r\n  //抓取指定菜單選項\r\n  menuList.addEventListener(\"click\",(e)=>{\r\n    // e.preventDefault();\r\n    let targetMenuSelection = e.target.closest(\"a\").dataset.category;\r\n    // console.log(targetMenuSelection)\r\n    localStorage.setItem('category', targetMenuSelection)\r\n  })\r\n    \r\n  //渲染菜單選單\r\n  function renderResturantMenu(){\r\n    let content = `\r\n    <li class=\"d-block d-flex justify-content-center align-items-end fs-5 fw-bold mb-11\">菜單<span class=\"text-primary fs-6 fw-normal ms-3\">Menu</span></li>\r\n    <li><a href=\"./menu.html\" data-category=\"\" class=\"d-block d-flex justify-content-center align-items-end btn border-0 fs-5 fw-bold mb-9\">熱門餐點<span class=\"link-primary fs-6 fw-normal ms-3 font-monospace\">Hot</span></a></li>\r\n    <li><a href=\"./menu.html\" data-category=\"\" class=\"d-block d-flex justify-content-center align-items-end btn border-0 fs-5 fw-bold mb-9\">分享餐<span class=\"link-primary fs-6 fw-normal ms-3 font-monospace\">Combo Meals</span></a></li>\r\n    <li><a href=\"./menu.html\" data-category=\"前菜\" class=\"d-block d-flex justify-content-center align-items-end btn border-0 fs-5 fw-bold mb-9\">前菜<span class=\"link-primary fs-6 fw-normal ms-3 font-monospace\">Appetizer</span></a></li>\r\n    <li><a href=\"./menu.html\" data-category=\"抱食主菜\" class=\"d-block d-flex justify-content-center align-items-end btn border-0 fs-5 fw-bold mb-9\">抱食主菜<span class=\"link-primary fs-6 fw-normal ms-3 font-monospace\">Sharing Courses</span></a></li>\r\n    <li><a href=\"./menu.html\" data-category=\"主廚精選\" class=\"d-block d-flex justify-content-center align-items-end btn border-0 fs-5 fw-bold mb-9\">主廚精選<span class=\"link-primary fs-6 fw-normal ms-3 font-monospace\">Delicate Courses</span></a></li>\r\n    <li><a href=\"./menu.html\" data-category=\"配菜\" class=\"d-block d-flex justify-content-center align-items-end btn border-0 fs-5 fw-bold mb-9\">配菜<span class=\"link-primary fs-6 fw-normal ms-3 font-monospace\">Side Dishes</span></a></li>\r\n    <li><a href=\"./menu.html\" data-category=\"甜點\" class=\"d-block d-flex justify-content-center align-items-end btn border-0 fs-5 fw-bold mb-9\">甜點<span class=\"link-primary fs-6 fw-normal ms-3 font-monospace\">Dessert</span></a></li>\r\n    <li><a href=\"./menu.html\" data-category=\"飲料及酒\" class=\"d-block d-flex justify-content-center align-items-end btn border-0 fs-5 fw-bold\">飲料 & 酒<span class=\"link-primary fs-6 fw-normal ms-3 font-monospace\">Beverages</span></a></li>\r\n    `\r\n    // console.log(content)\r\n    menuList.innerHTML = content;\r\n  }\r\n\r\n//選取桌號值\r\nbtnUserMenu.addEventListener(\"click\",(e)=>{\r\n  let tableSelection=e.target.nodeName;\r\n  if(tableSelection !== \"SELECT\"){\r\n    return\r\n  }\r\n  let tableId = e.target.value;\r\n  localStorage.setItem('tableId', tableId);\r\n})\r\n\r\n////購物車相關api\r\nconst cartList= document.querySelector(\".cart-body\");\r\n\r\n//指定刪除(垃圾桶)\r\ncartList.addEventListener(\"click\",(e)=>{\r\n  let targetA = e.target.closest(\"a\")\r\n  if(!targetA){\r\n    return\r\n  }\r\n  if(targetA.childNodes[0].nodeName==\"I\"){\r\n    let targetId = targetA.dataset.id;\r\n\r\n    const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n    axios.defaults.headers.common.Authorization = AUTH;\r\n  \r\n    const url = `${CARTS_URL}/${targetId}`;\r\n  \r\n    axios.delete(url)\r\n      .then(function (res) {\r\n\r\n        if (res.status === 200) {\r\n          renderCartState();\r\n        }\r\n      })\r\n      .catch(function (error) {\r\n        console.log('error:::', JSON.stringify(error, null, 2));\r\n      });\r\n  }\r\n})\r\n\r\n//確認是否購物空值\r\nconst btnConfirm = document.querySelector(\".js-confirm\")\r\n\r\nbtnConfirm.addEventListener(\"click\",(e)=>{\r\n  if(e.target.innerText!==\"加點\"){\r\n    return\r\n  }\r\n  const userId = getLoggedID();\r\n\r\n  const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n  axios.defaults.headers.common.Authorization = AUTH;\r\n  \r\n  const url = `${USERS_URL}/${userId}/carts?_expand=product&_expand=table`;\r\n\r\n  axios.get(url)\r\n  .then(res=>{\r\n    if (res.status === 200) {\r\n      cartData = res.data;\r\n      if(cartData.length==0){\r\n        sweetError(\"購物車是空的喔~\")\r\n        return\r\n      }\r\n      window.location.replace('https://github.com/JonathanHsu0817/pnp-sideproject/menu.html');\r\n      // window.location.replace('./menu.html')\r\n    }\r\n  })\r\n})\r\n//清空購物車\r\nconst deleteAllCart = document.querySelector(\".js-deleteAllCart\")\r\n\r\ndeleteAllCart.addEventListener(\"click\",(e)=>{\r\n  if(e.target.innerText!==\"清空購物車\"){\r\n    return\r\n  }\r\n  const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n  axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n  const carts = JSON.parse(localStorage.getItem('carts'));\r\n  // console.log(carts)\r\n  let arrayOfDelete = [];\r\n    carts.forEach((item) => {\r\n      const request = axiosDeleteCart(item.id);\r\n      arrayOfDelete.push(request);\r\n    });\r\n\r\n  Promise.all(arrayOfDelete)\r\n    .then(function (results) {\r\n    console.log('results:::', results);\r\n    if (results.length === arrayOfDelete.length) {\r\n      renderCartState();\r\n      sweetSuccess(\"已全部清空~~\")\r\n      setTimeout(() => {\r\n        console.log('Redirect!');\r\n        window.location.replace('https://github.com/JonathanHsu0817/pnp-sideproject/menu.html');\r\n        // window.location.replace('./menu.html');\r\n      }, 150);\r\n    }\r\n    })\r\n    .catch(function (error) {\r\n    console.log('error:::', JSON.stringify(error, null, 2));\r\n    });  \r\n})\r\n\r\n//清空購物車所設定promise function\r\nfunction axiosDeleteCart(cartId = 0) {\r\n  const url = `${CARTS_URL}/${cartId}`;\r\n  return axios.delete(url);\r\n}\r\n\r\n//渲染購物車\r\nfunction renderCartState(){\r\n  const userId = getLoggedID();\r\n\r\n  const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n  axios.defaults.headers.common.Authorization = AUTH;\r\n  \r\n  const url = `${USERS_URL}/${userId}/carts?_expand=product&_expand=table`;\r\n\r\n  axios.get(url)\r\n  .then(res=>{\r\n    if (res.status === 200) {\r\n      const cartData = res.data;\r\n      console.log(cartData)\r\n      if(cartData.length ==0){\r\n        renderNoCartData();\r\n        return;\r\n      }\r\n      localStorage.setItem('carts', JSON.stringify(cartData));\r\n      // console.log(cartData);\r\n      //計算總金額\r\n      let sum = 0;\r\n      let sumWithTax = 0;\r\n      cartData.forEach((item) => {\r\n      const intQty = Number(item.quantity);\r\n      const intPrice = Number(item.product.price);\r\n      const total = intQty * intPrice;\r\n      sum += total;\r\n      })\r\n      // console.log(newCartData)\r\n      renderCartList(cartData,sum)\r\n    }\r\n  })\r\n  //加入購物車按扭寫在menu.js & 各別product.js上(不同邏輯)\r\n}\r\nfunction renderNoCartData(){\r\n  let content =`\r\n  <div class=\"d-flex align-items-center justify-content-center\">\r\n    <p class=\"text-secondary my-16\">目前購物車是空的喔~</p>\r\n  </div>\r\n  `\r\n  cartList.innerHTML = content;\r\n}\r\n//渲染購物車畫面function\r\nfunction renderCartList(data,total){\r\n  let str =\"\";\r\n  data.forEach(item=>{\r\n    let list =`\r\n    <div class=\"cart-card d-flex align-items-center border-bottom border-1 pb-4 mb-4\">\r\n      <img class=\"cart-img object-position-top me-2 me-md-3\" src=\"${item.product.img}\" alt=\"food_pic\">\r\n      <div class=\"card-content col-5\">\r\n        <p class=\"mb-2\">${item.product.title}</p>\r\n        <span class=\"text-primary\">NT$${toThousandsComma(item.product.price)}</span>\r\n      </div>\r\n      <div class=\"cart-num col-2 ms-2 ms-md-3\">\r\n        <input type=\"number\" class=\"cart-input text-center lh-1 py-3\" id=\"cart-input\" value=\"${item.quantity}\">\r\n      </div>\r\n      <a href=\"#\" data-id=\"${item.id}\" class=\"cart-delete d-block ms-4 ms-md-3\"><i class=\"fas fa-trash-alt text-primary fs-4\"></i></a>\r\n    </div>`\r\n    str+=list;\r\n    });\r\n  let cartTotal =`\r\n    <div class=\"cart-charge-content d-flex mb-16\">\r\n      <div class=\"d-flex align-items-center ms-auto\">\r\n        <h5 class=\"mb-0\">小計金額</h5>\r\n        <span class=\"cart-charge-total text-primary fs-6 ms-3\">NT$${toThousandsComma(total)}</span>\r\n      </div>\r\n    </div>`\r\n  str+=cartTotal;\r\n\r\n  cartList.innerHTML = str;\r\n}\r\n\r\n function init() {\r\n    renderResturantMenu();\r\n    // console.log('getLoggedID():::', getLoggedID());\r\n    if (getLoggedID()) {\r\n      const localToken = localStorage.getItem('token');\r\n      const AUTH = `Bearer ${localToken}`;\r\n  \r\n      axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n      renderUserMenu();\r\n      \r\n      //購物車\r\n      renderCartState();\r\n    }\r\n    /* end of if-getLoggedID */\r\n    btnUserMenu.addEventListener('click', (event) => logout(event));\r\n  }\r\n  \r\n  // MAIN\r\n  init();\r\n\r\n  //utillities\r\nfunction　toThousandsComma(num){\r\n  return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n}"],"file":"renderUserLayout.js"}