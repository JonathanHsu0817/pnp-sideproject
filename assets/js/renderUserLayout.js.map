{"version":3,"sources":["renderUserLayout.js"],"names":["BASE_URL","LOGIN_URL","USERS_URL","PRODUCTS_URL","TABLES_URL","CARTS_URL","formLogin","document","querySelector","btnLogin","btnUserMenu","cartData","saveUserToLocal","accessToken","user","localStorage","setItem","id","nickname","login","console","log","url","data","email","value","trim","password","hasInput","axios","post","then","response","status","sweetSuccess","redirectPath","isAdmin","role","setTimeout","window","location","replace","error","sweetError","addEventListener","getLoggedID","getItem","templateOfUserMenu","template","renderUserMenu","userId","get","innerHTML","clear","logout","e","target","targetBtn","closest","tableSelection","nodeName","tableId","cartList","targetA","childNodes","targetId","dataset","AUTH","defaults","headers","common","Authorization","res","renderCartState","JSON","stringify","deleteAllCart","innerText","carts","parse","arrayOfDelete","forEach","item","request","axiosDeleteCart","push","Promise","all","results","length","cartId","sum","sumWithTax","intQty","Number","quantity","intPrice","product","price","total","renderCartList","str","list","img","title","cartTotal","init","localToken","event"],"mappings":"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","sourcesContent":["const BASE_URL = 'http://localhost:3000';\r\n// const BASE_URL = 'https://sideproject-pnp-json-server-vercel.vercel.app';\r\nconst LOGIN_URL = `${BASE_URL}/login`;\r\nconst USERS_URL = `${BASE_URL}/600/users`;\r\nconst PRODUCTS_URL = `${BASE_URL}/664/products`;\r\nconst TABLES_URL = `${BASE_URL}/644/tables`;\r\nconst CARTS_URL = `${BASE_URL}/600/carts`;\r\n\r\nconst formLogin = document.querySelector(\".js-form-login\");\r\nconst btnLogin = document.querySelector(\".js-btn-login\");\r\nconst btnUserMenu = document.querySelector('.js-user-selection');\r\n\r\nlet cartData = [];\r\n\r\n////登入頁面\r\n\r\n//存至localStorage\r\nfunction saveUserToLocal({ accessToken, user }) {\r\n  localStorage.setItem('token', accessToken);\r\n  localStorage.setItem('userId', user.id);\r\n  localStorage.setItem('nickname', user.nickname);\r\n}\r\n\r\n\r\nfunction login() {\r\n  console.log('Login!');\r\n\r\n  const url = `${LOGIN_URL}`;\r\n\r\n  const data = {\r\n    email: formLogin.email.value.trim(),\r\n    password: formLogin.password.value.trim(),\r\n  };\r\n\r\n  const hasInput = data.email && data.password;\r\n  if (hasInput) {\r\n    return axios\r\n      .post(url, data)\r\n      .then(function (response) {\r\n        // console.log('login:::', JSON.stringify(response, null, 2));\r\n        if (response.status === 200) {\r\n          sweetSuccess(\"登入成功!\", \"歡迎光臨~\")\r\n          saveUserToLocal(response.data);\r\n\r\n          let redirectPath = '/';\r\n          // const isAdmin = response.data?.user?.role?.includes('admin');\r\n          const isAdmin = response.data?.user?.role === 'admin';\r\n          if (isAdmin) {\r\n            redirectPath = 'admin.html';\r\n          }\r\n\r\n          setTimeout(() => {\r\n            console.log('Redirect!');\r\n            window.location.replace(redirectPath);\r\n          }, 150);\r\n          /* end of setTimeout */\r\n        }\r\n        /* end of response.OK */\r\n      })\r\n      .catch(function (error) {\r\n        sweetError(\"登入失敗\", \"再重新試一試喔~\")\r\n        // console.log('error:::', JSON.stringify(error, null, 2));\r\n      });\r\n    /*  end of axios */\r\n  }\r\n  /* end of IF-hasInput */\r\n}\r\nbtnLogin.addEventListener('click', () => login());\r\n\r\n//判斷登入後渲染登入畫面\r\nfunction getLoggedID() {\r\n    return localStorage.getItem('userId') || 0;\r\n}\r\n  /* end of hasLogged() */\r\n\r\nfunction templateOfUserMenu(user, template = '') {\r\n    // console.log('me:::', JSON.stringify(user, null, 2));\r\n    const isAdmin = user?.role === 'admin';\r\n    if (isAdmin) {\r\n      template = `\r\n        <li class=\"nav-item\">\r\n            <div class=\"d-flex\">\r\n                <a href=\"./admin.html\" class=\"d-block btn btn-outline-primary btn-bg-white me-2\">\r\n                前往後台\r\n                </a>\r\n            </div>\r\n        </li>\r\n      `;\r\n    }\r\n    /* end of (isAdmin) */\r\n\r\n    template += `\r\n          <li class=\"nav-item\">\r\n            <div class=\"d-flex\">\r\n                <select name=\"table-selection\" id=\"table-selection\" class=\"border-primary bg-backStage text-primary me-2\">\r\n                <option value=\"請選擇桌號\">請選擇桌號</option>\r\n                <option value=\"1\">B1</option>\r\n                <option value=\"2\">B2</option>\r\n                <option value=\"3\">B3</option>\r\n                <option value=\"4\">B4</option>\r\n                <option value=\"5\">B5</option>\r\n                <option value=\"6\">B6</option>\r\n                <option value=\"7\">B7</option>\r\n                <option value=\"8\">B8</option>\r\n                <option value=\"9\">B9</option>\r\n              </select>\r\n                <a href=\"#\" class=\"js-logout d-block btn btn-outline-primary btn-bg-white\">\r\n                登出\r\n                </a>\r\n            </div>\r\n        </li>\r\n    `;\r\n    return template;\r\n}\r\n  /* end of templateOfUserMenu() */ \r\n\r\n  function renderUserMenu() {\r\n    const userId = getLoggedID();\r\n    const url = `${BASE_URL}/600/users/${userId}`;\r\n  \r\n    // console.log('url >>> ', url);\r\n  \r\n    axios.get(url)\r\n    .then(function (response) {\r\n        // console.log('GET-Me:::', JSON.stringify(response, null, 2));\r\n        if (response.status === 200) {\r\n          // console.log('OK!');\r\n          document.querySelector('.js-user-selection').innerHTML = '';\r\n          btnUserMenu.innerHTML = templateOfUserMenu(response.data);\r\n        }\r\n        /* end of res-OK */\r\n    })\r\n    .catch(function (error) {\r\n        // console.log('error:::', JSON.stringify(error, null, 2));\r\n        if (error?.response?.status === 401) {\r\n            console.log('401');\r\n            // localStorage.removeItem('myCat');\r\n            localStorage.clear();\r\n        }\r\n    });\r\n  }\r\n  /* end of renderUserMenu() */  \r\n  function logout(e) {\r\n    const target = e.target;\r\n    // console.log('target:::', target);\r\n    const targetBtn = e.target.closest('.js-logout');\r\n    // console.log('targetBtn:::', targetBtn);\r\n    if (!targetBtn) {\r\n      return;\r\n    }\r\n  \r\n    localStorage.clear();\r\n  \r\n    setTimeout(() => {\r\n      window.location.replace('/');\r\n    }, 300);\r\n    /* end of setTimeout */\r\n  }\r\n  /* end of logout(event) */  \r\n\r\n//選取桌號值\r\nbtnUserMenu.addEventListener(\"click\",(e)=>{\r\n  let tableSelection=e.target.nodeName;\r\n  if(tableSelection !== \"SELECT\"){\r\n    return\r\n  }\r\n  let tableId = e.target.value;\r\n  localStorage.setItem('tableId', tableId);\r\n})\r\n\r\n////購物車相關api\r\nconst cartList= document.querySelector(\".cart-body\");\r\n\r\n//指定刪除(垃圾桶)\r\ncartList.addEventListener(\"click\",(e)=>{\r\n  let targetA = e.target.closest(\"a\")\r\n  console.log(targetA.childNodes[0].nodeName)\r\n  if(!targetA){\r\n    return\r\n  }\r\n  if(targetA.childNodes[0].nodeName==\"I\"){\r\n    let targetId = targetA.dataset.id;\r\n\r\n    const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n    axios.defaults.headers.common.Authorization = AUTH;\r\n  \r\n    const url = `${CARTS_URL}/${targetId}`;\r\n  \r\n    axios.delete(url)\r\n      .then(function (res) {\r\n      // console.log('carts:::', JSON.stringify(res, null, 2));\r\n        if (res.status === 200) {\r\n          renderCartState();\r\n        }\r\n      })\r\n      .catch(function (error) {\r\n        console.log('error:::', JSON.stringify(error, null, 2));\r\n      });\r\n  }\r\n})\r\n\r\n//清空購物車\r\nconst deleteAllCart = document.querySelector(\".js-deleteAllCart\")\r\n\r\ndeleteAllCart.addEventListener(\"click\",(e)=>{\r\n  if(e.target.innerText!==\"清空購物車\"){\r\n    return\r\n  }\r\n  const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n  axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n  const carts = JSON.parse(localStorage.getItem('carts'));\r\n  // console.log(carts)\r\n  let arrayOfDelete = [];\r\n    carts.forEach((item) => {\r\n      const request = axiosDeleteCart(item.id);\r\n      arrayOfDelete.push(request);\r\n    });\r\n\r\n  Promise.all(arrayOfDelete)\r\n    .then(function (results) {\r\n    console.log('results:::', results);\r\n    if (results.length === arrayOfDelete.length) {\r\n      renderCartState();\r\n      sweetSuccess(\"已全部清空~~\")\r\n      setTimeout(() => {\r\n        console.log('Redirect!');\r\n        window.location.replace('./menu-hot.html');\r\n      }, 150);\r\n    }\r\n    })\r\n    .catch(function (error) {\r\n    console.log('error:::', JSON.stringify(error, null, 2));\r\n    });  \r\n})\r\n\r\n//清空購物車所設定promise function\r\nfunction axiosDeleteCart(cartId = 0) {\r\n  const url = `${CARTS_URL}/${cartId}`;\r\n  return axios.delete(url);\r\n}\r\n\r\n//渲染購物車\r\nfunction renderCartState(){\r\n  const userId = getLoggedID();\r\n\r\n  const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n  axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n  // const params = new URLSearchParams(document.location.search);\r\n  // const productId = params.get('productId') || 1;\r\n\r\n  // #Step-2.4\r\n  const url = `${USERS_URL}/${userId}/carts?_expand=product&_expand=table`;\r\n\r\n  axios.get(url)\r\n  .then(res=>{\r\n    if (res.status === 200) {\r\n      const cartData = res.data;\r\n      localStorage.setItem('carts', JSON.stringify(cartData));\r\n      // console.log(cartData);\r\n      //計算總金額\r\n      let sum = 0;\r\n      let sumWithTax = 0;\r\n      cartData.forEach((item) => {\r\n      const intQty = Number(item.quantity);\r\n      const intPrice = Number(item.product.price);\r\n      const total = intQty * intPrice;\r\n      sum += total;\r\n      // sumWithTax += (total + Math.round(intQty * intPrice * 0.1))\r\n      })\r\n\r\n      // const newCartData = cartData.map(item=>{\r\n      //   return {\r\n      //     \"userId\": item.userId,\r\n      //     \"productId\": item.productId,\r\n      //     \"tableId\": item.tableId,\r\n      //     \"quantity\": item.quantity,\r\n      //     \"id\": item.id,\r\n      //     \"totalSum\": sum,\r\n      //     \"totalSumWithTax\": sumWithTax\r\n      //   }\r\n      // })\r\n      // console.log(newCartData)\r\n      renderCartList(cartData,sum)\r\n    }\r\n  })\r\n  //加入購物車按扭寫在menu-hot.js & 各別product.js上(不同邏輯)\r\n}\r\n\r\n//渲染購物車畫面function\r\nfunction renderCartList(data,total){\r\n  let str =\"\";\r\n  data.forEach(item=>{\r\n    let list =`\r\n    <div class=\"cart-card d-flex align-items-center border-bottom border-1 pb-4 mb-4\">\r\n      <img class=\"cart-img object-position-top me-2 me-md-3\" src=\"${item.product.img}\" alt=\"food_pic\">\r\n      <div class=\"card-content col-5\">\r\n        <p class=\"mb-2\">${item.product.title}</p>\r\n        <span class=\"text-primary\">NT$${item.product.price}</span>\r\n      </div>\r\n      <div class=\"cart-num col-2 ms-2 ms-md-3\">\r\n        <input type=\"number\" class=\"cart-input text-center lh-1 py-3\" id=\"cart-input\" value=\"${item.quantity}\">\r\n      </div>\r\n      <a href=\"#\" data-id=\"${item.id}\" class=\"cart-delete d-block ms-4 ms-md-3\"><i class=\"fas fa-trash-alt text-primary fs-4\"></i></a>\r\n    </div>`\r\n    str+=list;\r\n    });\r\n  let cartTotal =`\r\n    <div class=\"cart-charge-content d-flex mb-16\">\r\n      <div class=\"d-flex align-items-center ms-auto\">\r\n        <h5 class=\"mb-0\">小計金額</h5>\r\n        <span class=\"cart-charge-total text-primary fs-6 ms-3\">NT$${total}</span>\r\n      </div>\r\n    </div>`\r\n  str+=cartTotal;\r\n\r\n  cartList.innerHTML = str;\r\n}\r\n\r\n function init() {\r\n    // console.log('getLoggedID():::', getLoggedID());\r\n    if (getLoggedID()) {\r\n      const localToken = localStorage.getItem('token');\r\n      const AUTH = `Bearer ${localToken}`;\r\n  \r\n      axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n      renderUserMenu();\r\n\r\n      //購物車\r\n      renderCartState();\r\n    }\r\n    /* end of if-getLoggedID */\r\n    btnUserMenu.addEventListener('click', (event) => logout(event));\r\n  }\r\n  \r\n  // MAIN\r\n  init();"],"file":"renderUserLayout.js"}