{"version":3,"sources":["menu.js"],"names":["BASE_URL","BASE_PAGE","USERS_URL","getLoggedID","localStorage","getItem","getTableID","getCategory","menuPage","document","querySelector","userSelection","addEventListener","menuAddtoCart","e","addBtnInMenu","target","innerText","selectedImg","nodeName","productId","parentNode","dataset","id","setItem","userId","tableId","AUTH","axios","defaults","headers","common","Authorization","data","quantity","url","postToCart","post","then","response","status","renderCartState","sweetSmallSuccess","error","console","log","JSON","stringify","clear","window","location","replace","templateOfProducts","products","template","list","forEach","item","img","title","toThousandsComma","price","page","pagination","totalPages","renderProducts","element","liTag","beforePages","pageActive","afterPages","pageLength","innerHTML","category","get","productsData","alert","init","num","toString"],"mappings":"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","sourcesContent":["// const BASE_URL = 'http://localhost:3000';\r\nconst BASE_URL = 'https://sideproject-pnp-json-server-vercel.vercel.app';\r\nlet BASE_PAGE = 1\r\n// const BASE_PRODUCT_URL = `${BASE_URL}/664/products?_page=${BASE_PAGE}&_limit=6`;\r\nconst USERS_URL = `${BASE_URL}/600/users`;\r\n\r\n\r\nfunction getLoggedID() {\r\n  return localStorage.getItem('userId') || 0;\r\n}\r\n\r\nfunction getTableID() {\r\n  return localStorage.getItem('tableId') || 0;\r\n}\r\n\r\nfunction getCategory() {\r\n  return localStorage.getItem('category') || 0;\r\n}\r\n\r\nconst menuPage = document.querySelector(\".menu-container\");\r\n// console.log(menuPage)\r\n\r\n//在目錄加入購物車按扭\r\n// const productsContent = document.querySelector(\".products-hot-content\")\r\nconst userSelection = document.querySelector(\".js-user-selection\");\r\n// console.log(userSelection);\r\n\r\nmenuPage.addEventListener(\"click\",menuAddtoCart);\r\n\r\nfunction menuAddtoCart(e) {\r\n  let addBtnInMenu = e.target.innerText;\r\n  let selectedImg = e.target.nodeName\r\n  if(selectedImg==\"IMG\"){\r\n    let productId = e.target.parentNode.dataset.id;\r\n    localStorage.setItem('productId', productId) || 0;\r\n  }\r\n  if(addBtnInMenu == \"加入購物車\"){\r\n    let productId = e.target.dataset.id;\r\n    let userId = getLoggedID();\r\n    let tableId = getTableID();\r\n\r\n    //確認購物車是否有重複\r\n    const AUTH = `Bearer ${localStorage.getItem('token')}`;\r\n    axios.defaults.headers.common.Authorization = AUTH;\r\n\r\n    const data = {\r\n      userId: userId,\r\n      productId: productId,\r\n      tableId: tableId,\r\n      quantity: 1\r\n    }\r\n    const url = `${USERS_URL}/${userId}/carts`;\r\n\r\n    postToCart(url,data);\r\n  }\r\n}\r\n\r\nfunction postToCart(url,data){\r\n  axios.post(url, data)\r\n  .then(function (response) {\r\n  // console.log('carts:::', JSON.stringify(response, null, 2))\r\n    if (response.status === 201) {\r\n    renderCartState();\r\n    sweetSmallSuccess(\"成功加入購物車~~\")\r\n    }\r\n  })\r\n  .catch(function (error) {\r\n    console.log('error:::', JSON.stringify(error, null, 2));\r\n\r\n    if (error?.response?.status === 401) {\r\n      console.log('401');\r\n      localStorage.clear();\r\n      window.location.replace('/login.html');\r\n    }\r\n  });\r\n}\r\n\r\n//渲染卡片\r\nfunction templateOfProducts(products, template = ``) {\r\n    // console.log('products:::', JSON.stringify(products, null, 2));\r\n    let list = \"\";\r\n    products.forEach(function (item) {\r\n      list += `\r\n          <div class=\"col-md-4 col-6 mb-4\">\r\n              <div class=\"card border-0 shadow rounded-3 position-relative h-100\">\r\n                  <a href=\"./product.html?productId=${item.id}\" data-id=\"${item.id}\" class=\"overflow-hidden d-block\"><img src=\"${item.img}\" class=\"img-top img-fluid rounded-top\" alt=\"food-picz\"></a>\r\n                  <div class=\"card-body d-flex flex-column align-items-center text-center\">\r\n                      <h3 class=\"fs-5 text-black\">${item.title}</h3>\r\n                      <span class=\"text-primary mb-2\">NT $${toThousandsComma(item.price)}</span>\r\n                      <a href=\"#\" data-id=\"${item.id}\" class=\"js-addToCartBtn btn btn-outline-primary rounded-3 btn-text-white btn-xl mt-3 mt-auto\">\r\n                          加入購物車\r\n                      </a>\r\n                  </div>\r\n              </div>    \r\n          </div>\r\n    `;\r\n  });\r\n    // products.find(item=>{\r\n    //   return item.category\r\n    // })\r\n    // console.log(products)\r\n    // if(products.category==undefined){\r\n    //   products.category=`熱門餐點`;\r\n    //   products.category_e = `Popular Dishes`\r\n    // }\r\n    let page =`\r\n    <nav>\r\n      <div class=\"d-flex justify-content-center py-7\">\r\n        <h2 class=\"nav-title mb-0 pb-2\">熱門餐點<span class=\"font-monospace text-primary fs-7 ms-4\">Popular Dishes</span></h3>\r\n      </div>\r\n    </nav>\r\n    <div class=\"row mb-0 products-hot-content\">\r\n      ${list}\r\n    </div>\r\n    `\r\n    template += page\r\n    \r\n    /* end of products.forEach() */\r\n    return template;\r\n  }\r\n\r\n\r\n  //pagination切換\r\n  const pagination = document.querySelector(\".pagination\")\r\n  let totalPages = 5\r\n  \r\n  pagination.addEventListener(\"click\",(e)=>{\r\n    // console.log(e.target)\r\n    if(e.target.innerText==\"»\"){\r\n      BASE_PAGE++\r\n    }else if(e.target.innerText==\"«\"){\r\n      BASE_PAGE--\r\n    }else{\r\n      BASE_PAGE = e.target.innerText\r\n    }\r\n    renderProducts(BASE_PAGE);\r\n  })\r\n\r\n  function element(totalPages,page){\r\n    let liTag = '';\r\n    let beforePages = page-1;\r\n    let pageActive;\r\n    let afterPages = page+1\r\n    if(page>1){\r\n      liTag += `<li class=\"page-item\" onclick=\"element(totalPages,${page-1})\"><a class=\"page-link\" href=\"#\" aria-label=\"Previous\"><span aria-hidden=\"true\">&laquo;</span></a>`\r\n    }\r\n    if(page>2){\r\n      liTag += `<li class=\"page-item\" onclick=\"element(totalPages,1)\"><a class=\"page-link\" href=\"#\">1</a></li>`\r\n    }\r\n    if(page>3){\r\n      liTag += `<li class=\"page-item\"><a class=\"page-link\" href=\"#\">...</a></li>`\r\n    }\r\n    //顯示多少頁面\r\n    if(page == totalPages){\r\n      beforePages-=1;\r\n    }else if(page == 1){\r\n      afterPages+=1;\r\n    }\r\n    \r\n    for(let pageLength = beforePages; pageLength<=afterPages;pageLength++){\r\n      if(pageLength>totalPages){\r\n        continue;\r\n      }\r\n      if(pageLength==0){\r\n        pageLength++;\r\n      }\r\n      if(page == pageLength){\r\n        pageActive = 'active';\r\n      }else{\r\n        pageActive ='';\r\n      }\r\n      liTag += `<li class=\"page-item ${pageActive}\" onclick=\"element(totalPages,${pageLength})\"><a class=\"page-link\" href=\"#\">${pageLength}</a></li>`\r\n    }\r\n    if(page<totalPages-1){\r\n      if(page<totalPages-2){\r\n        liTag += `<li class=\"page-item\" onclick=\"element(totalPages,${totalPages-1})\"><a class=\"page-link\" href=\"#\">...</a></li>`\r\n      }\r\n      liTag += `<li class=\"page-item\" onclick=\"element(totalPages,${totalPages})\"\"><a class=\"page-link\" href=\"#\">${totalPages}</a></li>`\r\n    }\r\n    if(page<totalPages){\r\n      liTag += `<li class=\"page-item\" onclick=\"element(totalPages,${page+1})\"><a class=\"page-link\" href=\"#\" aria-label=\"Next\"><span aria-hidden=\"true\">&raquo;</span></a>`\r\n    }\r\n    pagination.innerHTML = liTag;\r\n  }\r\n  \r\nfunction renderProducts(page) {\r\n    let category = getCategory();\r\n    (!category)? category=``:category = `category=${getCategory()}&`;\r\n    const url = `${BASE_URL}/products?${category}_page=${page}&_limit=6`;\r\n    axios\r\n      .get(url)\r\n      .then(function (response) {\r\n        // console.log('GET-Products:::', JSON.stringify(response, null, 2));\r\n\r\n        if (response.status === 200) {\r\n          \r\n          let productsData  = response.data;\r\n          // console.log(productsData)\r\n          menuPage.innerHTML = templateOfProducts(productsData);\r\n        }\r\n      })\r\n\r\n      .catch(function (error) {\r\n        // console.log('error:::', JSON.stringify(error, null, 2));\r\n       alert(error?.response?.status || error); \r\n      });\r\n\r\n    /*  end of axios */\r\n  }\r\n\r\n  function init(){\r\n    element(totalPages,1)\r\n    renderProducts(BASE_PAGE);\r\n  }\r\n  \r\n  init();\r\n\r\n//utillities\r\nfunction　toThousandsComma(num){\r\n  return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n}"],"file":"menu.js"}