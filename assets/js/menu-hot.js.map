{"version":3,"sources":["menu-hot.js"],"names":["BASE_URL","BASE_PAGE","USERS_URL","getLoggedID","localStorage","getItem","getTableID","productsContent","document","querySelector","userSelection","addEventListener","menuAddtoCart","e","addBtnInMenu","target","innerText","selectedImg","nodeName","productId","parentNode","dataset","id","setItem","userId","tableId","data","quantity","url","postToCart","axios","post","then","response","status","renderCartState","sweetSmallSuccess","error","console","log","JSON","stringify","clear","window","location","replace","templateOfProducts","products","template","forEach","item","img","title","price","pagination","totalPages","renderProducts","element","page","liTag","beforePages","pageActive","afterPages","pageLength","innerHTML","get","productsData","alert","init"],"mappings":"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","sourcesContent":["const BASE_URL = 'http://localhost:3000';\r\n// const BASE_URL = 'https://sideproject-pnp-json-server-vercel.vercel.app/';\r\nlet BASE_PAGE = 1\r\n// const BASE_PRODUCT_URL = `${BASE_URL}/664/products?_page=${BASE_PAGE}&_limit=6`;\r\nconst USERS_URL = `${BASE_URL}/600/users`;\r\n\r\nfunction getLoggedID() {\r\n  return localStorage.getItem('userId') || 0;\r\n}\r\n\r\nfunction getTableID() {\r\n  return localStorage.getItem('tableId') || 0;\r\n}\r\n\r\n//在目錄加入購物車按扭\r\nconst productsContent = document.querySelector(\".products-hot-content\")\r\nconst userSelection = document.querySelector(\".js-user-selection\");\r\n// console.log(userSelection);\r\n\r\nproductsContent.addEventListener(\"click\",menuAddtoCart);\r\n\r\nfunction menuAddtoCart(e) {\r\n  let addBtnInMenu = e.target.innerText;\r\n  let selectedImg = e.target.nodeName\r\n  if(selectedImg==\"IMG\"){\r\n    let productId = e.target.parentNode.dataset.id;\r\n    localStorage.setItem('productId', productId) || 0;\r\n  }\r\n  if(addBtnInMenu == \"加入購物車\"){\r\n    let productId = e.target.dataset.id;\r\n    let userId = getLoggedID();\r\n    let tableId = getTableID();\r\n\r\n    const data = {\r\n      userId: userId,\r\n      productId: productId,\r\n      tableId: tableId,\r\n      quantity: 1\r\n    }\r\n    const url = `${USERS_URL}/${userId}/carts`;\r\n\r\n    postToCart(url,data);\r\n  }\r\n}\r\n\r\nfunction postToCart(url,data){\r\n  axios.post(url, data)\r\n  .then(function (response) {\r\n  // console.log('carts:::', JSON.stringify(response, null, 2))\r\n    if (response.status === 201) {\r\n    renderCartState();\r\n    sweetSmallSuccess(\"成功加入購物車~~\")\r\n    }\r\n  })\r\n  .catch(function (error) {\r\n    console.log('error:::', JSON.stringify(error, null, 2));\r\n\r\n    if (error?.response?.status === 401) {\r\n      console.log('401');\r\n      localStorage.clear();\r\n      window.location.replace('/login.html');\r\n    }\r\n  });\r\n}\r\n\r\n//渲染卡片\r\nfunction templateOfProducts(products, template = ``) {\r\n    // console.log('products:::', JSON.stringify(products, null, 2));\r\n    products.forEach(function (item) {\r\n        template += `\r\n            <div class=\"col-md-4 col-sm-6\">\r\n                <div class=\"card border-0 shadow rounded-3 mb-4 position-relative\">\r\n                    <a href=\"./product.html?productId=${item.id}\" data-id=\"${item.id}\" class=\"overflow-hidden d-block\"><img src=\"${item.img}\" class=\"img-top img-fluid rounded-top\" alt=\"food-picz\"></a>\r\n                    <div class=\"card-body d-flex flex-column align-items-center text-center\">\r\n                        <h3 class=\"fs-5 text-black\">${item.title}</h3>\r\n                        <span class=\"text-primary\">NT $${item.price}</span>\r\n                        <a href=\"#\" data-id=\"${item.id}\" class=\"js-addToCartBtn btn btn-outline-primary rounded-3 btn-text-white btn-xl mt-3\">\r\n                            加入購物車\r\n                        </a>\r\n                    </div>\r\n                </div>    \r\n            </div>\r\n      `;\r\n    });\r\n    /* end of products.forEach() */\r\n    return template;\r\n  }\r\n\r\n\r\n  //pagination切換\r\n  const pagination = document.querySelector(\".pagination\")\r\n  let totalPages = 5\r\n  \r\n  pagination.addEventListener(\"click\",(e)=>{\r\n    console.log(e.target)\r\n    if(e.target.innerText==\"»\"){\r\n      BASE_PAGE++\r\n    }else if(e.target.innerText==\"«\"){\r\n      BASE_PAGE--\r\n    }else{\r\n      BASE_PAGE = e.target.innerText\r\n    }\r\n    renderProducts(BASE_PAGE);\r\n  })\r\n\r\n  function element(totalPages,page){\r\n    let liTag = '';\r\n    let beforePages = page-1;\r\n    let pageActive;\r\n    let afterPages = page+1\r\n    if(page>1){\r\n      liTag += `<li class=\"page-item\" onclick=\"element(totalPages,${page-1})\"><a class=\"page-link\" href=\"#\" aria-label=\"Previous\"><span aria-hidden=\"true\">&laquo;</span></a>`\r\n    }\r\n    if(page>2){\r\n      liTag += `<li class=\"page-item\" onclick=\"element(totalPages,1)\"><a class=\"page-link\" href=\"#\">1</a></li>`\r\n    }\r\n    if(page>3){\r\n      liTag += `<li class=\"page-item\"><a class=\"page-link\" href=\"#\">...</a></li>`\r\n    }\r\n    //顯示多少頁面\r\n    if(page == totalPages){\r\n      beforePages-=1;\r\n    }else if(page == 1){\r\n      afterPages+=1;\r\n    }\r\n    \r\n    for(let pageLength = beforePages; pageLength<=afterPages;pageLength++){\r\n      if(pageLength>totalPages){\r\n        continue;\r\n      }\r\n      if(pageLength==0){\r\n        pageLength++;\r\n      }\r\n      if(page == pageLength){\r\n        pageActive = 'active';\r\n      }else{\r\n        pageActive ='';\r\n      }\r\n      liTag += `<li class=\"page-item ${pageActive}\" onclick=\"element(totalPages,${pageLength})\"><a class=\"page-link\" href=\"#\">${pageLength}</a></li>`\r\n    }\r\n    if(page<totalPages-1){\r\n      if(page<totalPages-2){\r\n        liTag += `<li class=\"page-item\" onclick=\"element(totalPages,${totalPages-1})\"><a class=\"page-link\" href=\"#\">...</a></li>`\r\n      }\r\n      liTag += `<li class=\"page-item\" onclick=\"element(totalPages,${totalPages})\"\"><a class=\"page-link\" href=\"#\">${totalPages}</a></li>`\r\n    }\r\n    if(page<totalPages){\r\n      liTag += `<li class=\"page-item\" onclick=\"element(totalPages,${page+1})\"><a class=\"page-link\" href=\"#\" aria-label=\"Next\"><span aria-hidden=\"true\">&raquo;</span></a>`\r\n    }\r\n    pagination.innerHTML = liTag;\r\n  }\r\n  \r\n\r\nfunction renderProducts(page) {\r\n    const url = `${BASE_URL}/664/products?_page=${page}&_limit=6`;\r\n    axios\r\n      .get(url)\r\n      .then(function (response) {\r\n        // console.log('GET-Products:::', JSON.stringify(response, null, 2));\r\n\r\n        if (response.status === 200) {\r\n          \r\n          const productsData = response.data;\r\n          productsContent.innerHTML = templateOfProducts(productsData);\r\n        }\r\n      })\r\n\r\n      .catch(function (error) {\r\n        // console.log('error:::', JSON.stringify(error, null, 2));\r\n       alert(error?.response?.status || error); \r\n      });\r\n\r\n    /*  end of axios */\r\n  }\r\n\r\n  function init(){\r\n    element(totalPages,1)\r\n    renderProducts(BASE_PAGE);\r\n  }\r\n  \r\n  init();"],"file":"menu-hot.js"}